<button
  mat-button
  color="primary"
  (click)="refreshData()"
  [disabled]="isLoading"
  class="refresh-button"
>
  <span class="icon-container">
    <span class="mina-icon icon-display"> refresh </span>
    <span *ngIf="!isLoading">Refresh</span>
    <span *ngIf="isLoading">Loading...</span>
  </span>
</button>

<div *ngIf="isLoading" class="loading-container">
  <mat-spinner [diameter]="16"></mat-spinner>
</div>

<div *ngIf="!isLoading && experiments.length === 0" class="error-container">
  <p>No experiments available.</p>
</div>

<div *ngIf="!isLoading && experiments.length > 0">
  <div class="table-container mat-elevation-z8">
    <table mat-table [dataSource]="experiments">
      <!-- Experiment Column -->
      <ng-container matColumnDef="exp">
        <th mat-header-cell *matHeaderCellDef><strong>Experiment</strong></th>
        <td mat-cell *matCellDef="let element; let i = index">
          <ng-container *ngIf="shouldShowExperiment(i)">
            <span [attr.rowspan]="getRowSpan(i)">
              <strong>{{ element.exp }}</strong>
            </span>
          </ng-container>
        </td>
      </ng-container>

      <ng-container matColumnDef="round">
        <th mat-header-cell *matHeaderCellDef><strong>Round</strong></th>
        <td mat-cell *matCellDef="let element">{{ element.round }}</td>
      </ng-container>

      <ng-container matColumnDef="rate_min">
        <th mat-header-cell *matHeaderCellDef>
          <strong>Total rate/min</strong>
        </th>
        <td mat-cell *matCellDef="let element">{{ element.rate_min }}</td>
      </ng-container>

      <ng-container matColumnDef="payment_rate_min">
        <th mat-header-cell *matHeaderCellDef>
          <strong>Value transfer rate/min</strong>
        </th>
        <td mat-cell *matCellDef="let element">
          {{ element.payment_rate_min }}
        </td>
      </ng-container>

      <ng-container matColumnDef="zkapp_rate_min">
        <th mat-header-cell *matHeaderCellDef>
          <strong>ZkApp rate/min</strong>
        </th>
        <td mat-cell *matCellDef="let element">{{ element.zkapp_rate_min }}</td>
      </ng-container>

      <ng-container matColumnDef="duration">
        <th mat-header-cell *matHeaderCellDef><strong>Duration</strong></th>
        <td mat-cell *matCellDef="let element">
          <ng-container *ngIf="element.duration.days">
            {{ element.duration.days }}d
          </ng-container>
          <ng-container *ngIf="element.duration.hours">
            {{ element.duration.hours }}h
          </ng-container>
          <ng-container *ngIf="element.duration.minutes">
            {{ element.duration.minutes }}m
          </ng-container>
          <ng-container *ngIf="element.duration.seconds">
            {{ element.duration.seconds }}s
          </ng-container>
        </td>
      </ng-container>

      <ng-container matColumnDef="max_latency">
        <th mat-header-cell *matHeaderCellDef><strong>Max latency</strong></th>
        <td mat-cell *matCellDef="let element">
          <ng-container *ngIf="element.max_latency.days">
            {{ element.max_latency.days }}d
          </ng-container>
          <ng-container *ngIf="element.max_latency.hours">
            {{ element.max_latency.hours }}h
          </ng-container>
          <ng-container *ngIf="element.max_latency.minutes">
            {{ element.max_latency.minutes }}m
          </ng-container>
          <ng-container *ngIf="element.max_latency.seconds">
            {{ element.max_latency.seconds }}s
          </ng-container>
          <ng-container *ngIf="element.max_latency.milliseconds">
            {{ element.max_latency.milliseconds | number : "1.0-3" }}ms
          </ng-container>
        </td>
      </ng-container>

      <ng-container matColumnDef="missed">
        <th mat-header-cell *matHeaderCellDef>
          <strong style="color: gray">Missed</strong>
        </th>
        <td mat-cell *matCellDef="let element">
          <span style="color: gray">{{ element.missed }}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="failed">
        <th mat-header-cell *matHeaderCellDef>
          <strong style="color: red">Failed</strong>
        </th>
        <td mat-cell *matCellDef="let element">
          <span style="color: red">{{ element.failed }}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="successful">
        <th mat-header-cell *matHeaderCellDef>
          <strong style="color: green">Successful</strong>
        </th>
        <td mat-cell *matCellDef="let element">
          <span style="color: green">{{ element.successful }}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="start">
        <th mat-header-cell *matHeaderCellDef><strong>Start</strong></th>
        <td mat-cell *matCellDef="let element">
          {{ element.start | date : "long" }}
        </td>
      </ng-container>

      <ng-container matColumnDef="total">
        <th mat-header-cell *matHeaderCellDef><strong>Total txns</strong></th>
        <td mat-cell *matCellDef="let element">{{ element.total }}</td>
      </ng-container>

      <ng-container matColumnDef="zkapps">
        <th mat-header-cell *matHeaderCellDef><strong>ZkApp txns</strong></th>
        <td mat-cell *matCellDef="let element">{{ element.zkapps }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>
</div>
